// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Story {
  id          Int     @id
  status      String  @default("PENDING") // PENDING, COMPLETED
  title       String
  titleZh     String? // Translated Chinese title
  url         String?
  author      String?
  points      Int     @default(0)
  postedAt    Int
  numComments Int     @default(0)
  domain      String?
  type        String? // story, comment, job, etc.
  kids        String? // Stored as JSON string of IDs
  text        String? // Ask HN content or internal text
  commentsDump String? // Stored as formatted text: "[Comment 1]: text..."

  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())

  // Relation to AI Summary
  aiSummary AiSummary?
}

model AiSummary {
  storyId Int   @id
  story   Story @relation(fields: [storyId], references: [id])

  technical String // Markdown
  technicalZh String? // Chinese Markdown

  layman    String // Text
  laymanZh  String? // Chinese Text

  comments  String // Markdown
  commentsZh String? // Chinese Markdown
  keywords  String // JSON string of string[]
  sentiment String // JSON string: { constructive: number, technical: number, controversial: number }

  createdAt DateTime @default(now())
}

model CronLock {
  id        String   @id
  lockedAt  DateTime
  expiresAt DateTime
}
